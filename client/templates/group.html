<template name="group">
  {{#if loading}}
    <div class="loading">
      <h2>Loading</h2>
    </div>
  {{else}}
    {{#if notFound}}
      <div class="not-found">
        <h2>404 Not found</h2>
        <p>Group not found. You might lack permissions to access it.{{#unless currentPersonId}} Try signing in.{{/unless}}</p>
      </div>
    {{else}}
      {{> groupName group}}
      <div class="row">
        <div class="col12 groups-directory">
          <h2>Group Activity</h2>
        </div>
        <div class="col4 push12 sidebar group-members-panel">
          {{> groupMembership group}}
          {{> groupMembers group}}
          {{> groupSettings group}}
        </div>
      </div>
    {{/if}}
  {{/if}}
</template>

<template name="groupName">
  <h1>{{name}}</h1>
</template>

<template name="groupMembership">
  {{#if currentPersonId}}
    {{#if isMember}}
      {{#if isPendingLeaveRequest}}
      {{> groupPendingLeaveRequest}}
      <br/><br/>
      {{/if}}
    {{else}}
      <h3 class="directory-title">Group membership</h3>
      {{#if isPendingMember}}
        {{> groupPendingMembership}}
      {{else}}
        {{> groupNoMembership}}
      {{/if}}
      <br/><br/>
    {{/if}}
  {{/if}}
</template>

<template name="groupNoMembership">
  {{#if closed}}
    This group is closed. You can't join nor request membership.
  {{else}}
    <button class="join-group">{{#if open}}Join group{{else}}Request membership{{/if}}</button>
  {{/if}}
</template>

<template name="groupPendingMembership">
  You have requested membership in this group. Please wait for one of the group admins to approve your request.
  <button class="cancel-request-to-join-group">Cancel request</button>
</template>

<template name="groupPendingLeaveRequest">
  You have requested to leave this group. Please wait for one of the group admins to approve your request.
  <button class="cancel-request-to-leave-group">Cancel request</button>
</template>

<template name="groupMembers">
  <div class="section">
    <h2>Members</h2>
    {{> groupMembersList}}
    {{> groupRequests}}
    {{> groupMembersAddControl}}
  </div>
</template>

<template name="groupMembersList">
  <ol class="members member-list">
    {{#each membersWithFlag}}
      {{> member}}
    {{/each}}
  </ol>
</template>

<template name="groupRequests">
  {{#if canModifyMembership}}
    {{#if joinRequestsCount}}
      <h3>Requests to join group</h3>
      <ol class="members member-list join-requests">
        {{#each joinRequests}}
          {{> request}}
        {{/each}}
      </ol>
    {{/if}}

    {{#if leaveRequestsCount}}
      <h3>Requests to leave group</h3>
      <ol class="members member-list leave-requests">
        {{#each leaveRequests}}
          {{> request}}
        {{/each}}
      </ol>
    {{/if}}
  {{/if}}
</template>

<template name="groupMembersAddControl">
  {{#if canModifyMembership}}
    <h3>Add a member</h3>
    <div class="add-control control">
      <input type="text" class="add-group-member" placeholder="Search by username, name, or email" />
      {{> groupMembersAddControlNoResults}}
      {{> groupMembersAddControlResults}}
      {{> groupMembersAddControlLoading}}
    </div>
    {{> groupMembersAddControlInviteHint}}
  {{/if}}
</template>

<template name="groupMembersAddControlNoResults">
  {{#if noResults}}
    <div class="no-results add-control-results">
      No people found
      {{> addControlInviteByEmail email}}
    </div>
  {{/if}}
</template>

<template name="addControlInviteByEmail">
  {{#if this}}
    {{! TODO: Button and input box should get disabled and a loading icon should be displayed until the method returns, if error happens input box should be refocused so that user can fix the input }}
    <button class="invite">Invite {{this}}</button>
  {{/if}}
</template>

<template name="groupMembersAddControlLoading">
  {{#if loading}}
    <div class="results-loading add-control-results">Loading â€¦</div>
  {{/if}}
</template>

<template name="groupMembersAddControlResults">
  {{#if results.count}}
    <ul class="group-member-results add-control-results">
      {{#each results}}
        {{> groupMembersAddControlResultsItem}}
      {{/each}}
    </ul>
  {{/if}}
</template>

<template name="groupMembersAddControlResultsItem">
  {{> memberAdd}}
</template>

<template name="groupSettings">
  <div class="settings section">
    <h2>Settings</h2>
    <div class="section">
      {{> accessControl}}
    </div>
    {{#if canRemove}}
      <div class="section">
        {{> groupAdminTools}}
      </div>
    {{/if}}
  </div>
</template>

<template name="groupAdminTools">
  <div class="admin-tools dropdown-trigger">
    <button class="borderless">
      <i class="icon-tools"></i> Admin tools
    </button>
    <div class="dropdown-anchor">
      <ul class="dropdown">
      {{#if canModify}}
        <li class="menu-item">
          Join group policy:
          <select class="group-join-policy">
            <option value="{{POLICY.APPROVAL}}" {{#if isCurrentJoinPolicy POLICY.APPROVAL}}selected="selected"{{/if}}> Approval </option>
            <option value="{{POLICY.OPEN}}" {{#if isCurrentJoinPolicy POLICY.OPEN}}selected="selected"{{/if}}> Open </option>
            <option value="{{POLICY.CLOSED}}" {{#if isCurrentJoinPolicy POLICY.CLOSED}}selected="selected"{{/if}}> Closed </option>
          </select>
        </li>
        <li class="menu-item">
          Leave group policy:
          <select class="group-leave-policy">
            <option value="{{POLICY.APPROVAL}}" {{#if isCurrentLeavePolicy POLICY.APPROVAL}}selected="selected"{{/if}}> Approval </option>
            <option value="{{POLICY.OPEN}}" {{#if isCurrentLeavePolicy POLICY.OPEN}}selected="selected"{{/if}}> Open </option>
            <option value="{{POLICY.CLOSED}}" {{#if isCurrentLeavePolicy POLICY.CLOSED}}selected="selected"{{/if}}> Closed </option>
          </select>
        </li>
      {{/if}}
        <li class="menu-item">
          {{! TODO: Add confirmation or undo for this action }}
          <button class="delete-group danger tooltip" title="Warning: there is no undo for this action.">Delete group</button>
        </li>
      </ul>
    </div>
  </div>
</template>

<template name="groupMembersAddControlInviteHint">
  {{#if visible}}
    <p class="hint">Enter an email to invite a new user.</p>
  {{/if}}
</template>
